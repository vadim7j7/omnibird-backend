# frozen_string_literal: true

module Public
  module V1
    module Endpoints
      class Tracking < Grape::API
        params do
          requires(:tracking_key, type: String, desc: 'Uniq tracking key')
        end
        route_param :tracking_key do
          format('txt')

          desc 'PNG Image to track open email by tracking_key' do
            summary('Track open email by tracking_key')
            produces(%w[image/png])
          end
          get '1x1.png' do
            image_data = [
              0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A,
              0x00, 0x00, 0x00, 0x0D, 0x49, 0x48, 0x44, 0x52,
              0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01,
              0x08, 0x06, 0x00, 0x00, 0x00, 0x1F, 0x15, 0xC4,
              0x89, 0x00, 0x00, 0x00, 0x0A, 0x49, 0x44, 0x41,
              0x54, 0x78, 0xDA, 0x63, 0x00, 0x01, 0x00, 0x00,
              0x05, 0x00, 0x01, 0xE2, 0x21, 0xBC, 0x33, 0x00,
              0x00, 0x00, 0x00, 0x49, 0x45, 0x4E, 0x44, 0xAE,
              0x42, 0x60, 0x82
            ].pack('C*')

            header('Content-Type', 'image/png')
            header('Content-Disposition', 'inline')

            body(image_data)
          end
        end
      end
    end
  end
end
